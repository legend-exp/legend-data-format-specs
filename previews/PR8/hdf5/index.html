<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>HDF5 · LEGEND Data Format Specifications</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://legend-exp.github.io/legend-data-format-specs/stable/hdf5/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.png" alt="LEGEND Data Format Specifications logo"/><img class="docs-dark-only" src="../assets/logo-dark.png" alt="LEGEND Data Format Specifications logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">LEGEND Data Format Specifications</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>HDF5</a><ul class="internal"><li><a class="tocitem" href="#HDF5-datasets,-groups-and-attributes"><span>HDF5 datasets, groups and attributes</span></a></li><li><a class="tocitem" href="#Basic-types"><span>Basic types</span></a></li><li><a class="tocitem" href="#Encoded-arrays"><span>Encoded arrays</span></a></li><li><a class="tocitem" href="#Histograms"><span>Histograms</span></a></li></ul></li><li><a class="tocitem" href="../metadata/">Metadata</a></li><li><a class="tocitem" href="../daq_data/">DAQ Data</a></li><li><a class="tocitem" href="../data_compression/">Data Compression</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>HDF5</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>HDF5</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/legend-exp/legend-data-format-specs/blob/main/docs/src/hdf5.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="HDF5-File-Format"><a class="docs-heading-anchor" href="#HDF5-File-Format">HDF5 File Format</a><a id="HDF5-File-Format-1"></a><a class="docs-heading-anchor-permalink" href="#HDF5-File-Format" title="Permalink"></a></h1><ul><li><a href="#HDF5-File-Format">HDF5 File Format</a></li><li class="no-marker"><ul><li><a href="#HDF5-datasets,-groups-and-attributes">HDF5 datasets, groups and attributes</a></li><li><a href="#Basic-types">Basic types</a></li><li class="no-marker"><ul><li><a href="#Scalar">Scalar</a></li><li><a href="#Array">Array</a></li><li class="no-marker"><ul><li><a href="#Fixed-sized-array">Fixed-sized array</a></li><li><a href="#Array-of-equal-sized-arrays">Array of equal-sized arrays</a></li><li><a href="#Vector-of-vectors">Vector of vectors</a></li></ul></li><li><a href="#Struct">Struct</a></li><li><a href="#Table">Table</a></li><li><a href="#Enum">Enum</a></li><li><a href="#Values-with-physical-units">Values with physical units</a></li></ul></li><li><a href="#Encoded-arrays">Encoded arrays</a></li><li class="no-marker"><ul><li><a href="#Encoded-[Array-of-equal-sized-arrays](@ref)">Encoded Array of equal-sized arrays</a></li><li><a href="#Encoded-[Vector-of-vectors](@ref)">Encoded Vector of vectors</a></li></ul></li><li><a href="#Histograms">Histograms</a></li></ul></li></ul><p><a href="https://www.hdfgroup.org/solutions/hdf5">HDF5</a> is used as the primary binary data format in LEGEND.</p><p>The following describes a mapping between the abstract data model and HDF5. This specifies the structure of the HDF5 implicitly, but precisely, for any data that conforms to the data model. The mapping purposefully uses only common and basic HDF5 features, to ensure it can be easily and reliably implemented in multiple programming languages.</p><h2 id="HDF5-datasets,-groups-and-attributes"><a class="docs-heading-anchor" href="#HDF5-datasets,-groups-and-attributes">HDF5 datasets, groups and attributes</a><a id="HDF5-datasets,-groups-and-attributes-1"></a><a class="docs-heading-anchor-permalink" href="#HDF5-datasets,-groups-and-attributes" title="Permalink"></a></h2><p>Different data types may be stored as an HDF5 dataset of the same type (e.g. a 2-dimensional dataset may represent a matrix or a vector of same-sized vectors). To make the HDF5 files self-documenting, the HDF5 attribute <code>datatype</code> is used to indicate the type semantics of datasets and groups.</p><h2 id="Basic-types"><a class="docs-heading-anchor" href="#Basic-types">Basic types</a><a id="Basic-types-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-types" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">Quick reference</header><div class="admonition-body"><table><tr><th style="text-align: right">Data type</th><th style="text-align: right"><code>datatype</code> attribute</th></tr><tr><td style="text-align: right">Scalar</td><td style="text-align: right"><code>real</code>, <code>string</code>, <code>symbol</code>, <code>bool</code>, ...</td></tr><tr><td style="text-align: right">Flat <span>$n$</span>-dimensional array</td><td style="text-align: right"><code>array&lt;n&gt;{ELTYPE}</code></td></tr><tr><td style="text-align: right">Fixed-sized <span>$n$</span>-dimensional array</td><td style="text-align: right"><code>fixedsize_array&lt;n&gt;{ELTYPE}</code></td></tr><tr><td style="text-align: right"><span>$n$</span>-dimensional array of <span>$m$</span>-dimensional arrays of the same size</td><td style="text-align: right"><code>array_of_equalsized_arrays&lt;n,m&gt;{ELTYPE}</code></td></tr><tr><td style="text-align: right">Vector of vectors of different size</td><td style="text-align: right"><code>array&lt;1&gt;{ARRAY-LIKE_DATATYPE}</code></td></tr><tr><td style="text-align: right">Struct</td><td style="text-align: right"><code>struct{FIELDNAME_1,FIELDNAME_2,...}</code></td></tr><tr><td style="text-align: right">Table</td><td style="text-align: right"><code>table{COLNAME_1,COLNAME_2,...}</code></td></tr><tr><td style="text-align: right">Enum</td><td style="text-align: right"><code>enum{NAME_1=INT_VAL_1,NAME_2=INT_VAL_2,...}</code></td></tr><tr><td style="text-align: right">Encoded vector of vectors of different size</td><td style="text-align: right"><code>array&lt;1&gt;{encoded_array&lt;1&gt;{ELTYPE}}</code></td></tr><tr><td style="text-align: right">Encoded array of arrays of the same size</td><td style="text-align: right"><code>array_of_equalsized_encoded_arrays&lt;n,m&gt;{ELTYPE}</code></td></tr></table></div></div><p>The abstract data model is mapped as follows:</p><h3 id="Scalar"><a class="docs-heading-anchor" href="#Scalar">Scalar</a><a id="Scalar-1"></a><a class="docs-heading-anchor-permalink" href="#Scalar" title="Permalink"></a></h3><p>Single scalar values are stored as 0-dimensional HDF5 datasets.</p><pre><code class="nohighlight hljs">DATASET &quot;scalar&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;real&quot;
    DATA = 3.14
}</code></pre><h3 id="Array"><a class="docs-heading-anchor" href="#Array">Array</a><a id="Array-1"></a><a class="docs-heading-anchor-permalink" href="#Array" title="Permalink"></a></h3><p>Collections of values. The <code>datatype</code> attribute will always contain <code>array</code>.</p><p>Flat <span>$n$</span>-dimensional arrays are stored as <span>$n$</span>-dimensional HDF5 datasets.</p><pre><code class="nohighlight hljs">DATASET &quot;unixtime&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
    ATTRIBUTE &quot;units&quot; = &quot;ns&quot;
    DATA = [1.44061e+09, 1.44061e+09, ...]
}</code></pre><h4 id="Fixed-sized-array"><a class="docs-heading-anchor" href="#Fixed-sized-array">Fixed-sized array</a><a id="Fixed-sized-array-1"></a><a class="docs-heading-anchor-permalink" href="#Fixed-sized-array" title="Permalink"></a></h4><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Undocumented</p></div></div><h4 id="Array-of-equal-sized-arrays"><a class="docs-heading-anchor" href="#Array-of-equal-sized-arrays">Array of equal-sized arrays</a><a id="Array-of-equal-sized-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Array-of-equal-sized-arrays" title="Permalink"></a></h4><p><span>$n-$</span>dimensional arrays of <span>$m$</span>-dimensional arrays of the same size are stored as flat <span>$n+m$</span> dimensional datasets.</p><pre><code class="nohighlight hljs">DATASET &quot;waveform_values&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1,1&gt;{real}&quot;
    DATA = [[13712, 13712, 13683, ..., 15400]
            [13072, 13072, 12992, ..., 18806]
            ...
            [16918, 16918, 16962, ..., 18933]]
}</code></pre><h4 id="Vector-of-vectors"><a class="docs-heading-anchor" href="#Vector-of-vectors">Vector of vectors</a><a id="Vector-of-vectors-1"></a><a class="docs-heading-anchor-permalink" href="#Vector-of-vectors" title="Permalink"></a></h4><p>A vector of vectors of unqual sizes is stored as an HDF5 group that contains two datasets:</p><ul><li>An array-like dataset <code>flattened_data</code> that stores the concatenation of all vectors into a single vector. Can be <code>*array&lt;n&gt;{...}</code>, <code>table{...}</code>, etc.</li><li>A 1-dimensional dataset <code>cumulative_length</code> that stores the cumulative sum of the length of all vectors (refers to axis 0 in <code>flattened_data</code>).</li></ul><p>The two datasets in the group also have <code>datatype</code> (and possibly <code>units</code>) attributes that match their content.</p><pre><code class="nohighlight hljs">GROUP &quot;vector_of_vectors&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{ARRAY-LIKE_DATATYPE}&quot;
    DATASET &quot;flattened_data&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;ARRAY-LIKE_DATATYPE&quot;
        DATA = ...
    }
    DATASET &quot;cumulative_length&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
        DATA = [3, 10, 34, ...]
    }
}</code></pre><h3 id="Struct"><a class="docs-heading-anchor" href="#Struct">Struct</a><a id="Struct-1"></a><a class="docs-heading-anchor-permalink" href="#Struct" title="Permalink"></a></h3><p>Structs are stored as HDF5 groups. Fields that are structs themselves are stored as sub-groups, scalars and arrays as datasets. Groups and datasets in the group are named after the fields of the struct.</p><pre><code class="nohighlight hljs">GROUP &quot;struct&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;struct{array1,flag2,obj3}
    DATASET &quot;array1&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
        DATA = [5, 23, 4, ...]
    }
    DATASET &quot;flag2&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;bool&quot;
        DATA = 0
    }
    GROUP &quot;obj3&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;struct{obj2}&quot;
        ...
    }
}</code></pre><h3 id="Table"><a class="docs-heading-anchor" href="#Table">Table</a><a id="Table-1"></a><a class="docs-heading-anchor-permalink" href="#Table" title="Permalink"></a></h3><p>A table is struct where all the fields (also called &quot;columns&quot;) have the same length. It is stored as a group of datasets, each representing a column of the table.</p><pre><code class="nohighlight hljs">GROUP &quot;waveform&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;table{t0,dt,values}&quot;
    DATASET &quot;dt&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
        ATTRIBUTE &quot;units&quot; = &quot;ns&quot;
        DATA = [10, 10, 10, ...]
    }
    DATASET &quot;t0&quot; {
        ATTRIBUTE &quot;datatype&quot;= &quot;array&lt;1&gt;{real}&quot;
        ATTRIBUTE &quot;units&quot; = &quot;ns&quot;
        DATA = [76420, 76420, 76420, ...]
    }
    GROUP &quot;values&quot; {
        ATTRIBUTE &quot;datatype&quot;= &quot;array&lt;1&gt;{array&lt;1&gt;{real}}&quot;
        DATASET &quot;cumulative_length&quot; {
            ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
            DATA = [1000, 2000, 3000, 4000, ...]
        }
        DATASET &quot;flattened_data&quot; {
            ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
            DATA = [14440, 14442, 14441, 14434, ...]
        }
    }
}</code></pre><h3 id="Enum"><a class="docs-heading-anchor" href="#Enum">Enum</a><a id="Enum-1"></a><a class="docs-heading-anchor-permalink" href="#Enum" title="Permalink"></a></h3><p>Enum values are stored as integer values, but with the <code>datatype</code> attribute: <code>enum{NAME=INT_VALUE,...}</code></p><pre><code class="nohighlight hljs">DATASET &quot;evttype&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{enum{evt_real=1,evt_pulser=2,evt_baseline=4}}&quot;
    DATA = [1, 2, 1, 1, ...]
}</code></pre><h3 id="Values-with-physical-units"><a class="docs-heading-anchor" href="#Values-with-physical-units">Values with physical units</a><a id="Values-with-physical-units-1"></a><a class="docs-heading-anchor-permalink" href="#Values-with-physical-units" title="Permalink"></a></h3><p>For values with physical units, the dataset only contains the numerical values. The attribute <code>units</code> stores the unit information. Its value is the string representation of the common scientific notation for the unit. Unicode must not be used.</p><pre><code class="nohighlight hljs">DATASET &quot;energy&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
    ATTRIBUTE &quot;units&quot; = &quot;keV&quot;
    DATA = {2453.25, 234.34, 2039.22, ...]
}</code></pre><h2 id="Encoded-arrays"><a class="docs-heading-anchor" href="#Encoded-arrays">Encoded arrays</a><a id="Encoded-arrays-1"></a><a class="docs-heading-anchor-permalink" href="#Encoded-arrays" title="Permalink"></a></h2><p>Specialized structures should exist to represent encoded data. An important application is for lossless compression of waveform vectors (see <a href="../data_compression/#Data-Compression">Data Compression</a>). All HDF5 objects representing encoded arrays must carry (in addition to the usual <code>datatype</code>) a <code>codec</code> string attribute holding the encoder algorithm identifier (a list can be found in <a href="../data_compression/#Data-Compression">Data Compression</a>) in order to be decoded. Some decoders might require additional mandatory attributes.</p><h3 id="Encoded-[Array-of-equal-sized-arrays](@ref)"><a class="docs-heading-anchor" href="#Encoded-[Array-of-equal-sized-arrays](@ref)">Encoded <a href="#Array-of-equal-sized-arrays">Array of equal-sized arrays</a></a><a id="Encoded-[Array-of-equal-sized-arrays](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#Encoded-[Array-of-equal-sized-arrays](@ref)" title="Permalink"></a></h3><p>An encoded array of equal-sized arrays is stored as an HDF5 group that contains two datasets:</p><ul><li><code>encoded_data</code>: the encoded data, for example a <a href="#Vector-of-vectors">Vector of vectors</a>. The type of the elements must be unsigned 8-bit integers (i.e. bytes)</li><li><code>decoded_size</code>: 1-dimensional dataset that stores the lengths of the original (decoded) arrays</li></ul><p>Example of encoded waveform values, where <code>encoded_data</code> is an <code>array&lt;1&gt;{array&lt;1&gt;{real}}</code> of bytes.</p><pre><code class="nohighlight hljs">GROUP &quot;waveform_values&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;array_of_encoded_equalsized_arrays&lt;1,1&gt;{real}&quot;
    ATTRIBUTE &quot;codec&quot; = &quot;radware_sigcompress&quot;
    ATTRIBUTE &quot;codec_shift&quot; = -32768
    GROUP &quot;encoded_data&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{array&lt;1&gt;{real}}&quot;
        DATASET &quot;cumulative_length&quot; {
            ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
            DATA = [...]
        }
        DATASET &quot;flattened_data&quot; {
            ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
            DATA = [...]
        }
    }
    DATASET &quot;decoded_size&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;real&quot;
        DATA = ...
    }</code></pre><h3 id="Encoded-[Vector-of-vectors](@ref)"><a class="docs-heading-anchor" href="#Encoded-[Vector-of-vectors](@ref)">Encoded <a href="#Vector-of-vectors">Vector of vectors</a></a><a id="Encoded-[Vector-of-vectors](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#Encoded-[Vector-of-vectors](@ref)" title="Permalink"></a></h3><p>An encoded vector of vectors of unqual sizes is stored as an HDF5 group that contains two datasets:</p><ul><li><code>encoded_data</code>: the encoded data, for example a <a href="#Vector-of-vectors">Vector of vectors</a>. The type of the elements must be unsigned 8-bit integers (i.e. bytes)</li><li><code>decoded_size</code>: 0-dimensional (i.e. scalar) dataset that stores the length of the original (decoded) arrays</li></ul><h2 id="Histograms"><a class="docs-heading-anchor" href="#Histograms">Histograms</a><a id="Histograms-1"></a><a class="docs-heading-anchor-permalink" href="#Histograms" title="Permalink"></a></h2><p>A 1-dimensional histogram will be written as</p><pre><code class="nohighlight hljs">GROUP &quot;hist_1d&quot; {
    ATTRIBUTE &quot;datatype&quot; = &quot;struct{binning,weights,isdensity}&quot;
    GROUP &quot;binning&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;struct{axis_1}&quot;
        GROUP &quot;axis_1&quot; {
            ATTRIBUTE &quot;datatype&quot; = &quot;struct{binedges,closedleft}&quot;
            GROUP &quot;binedges&quot; {
                ATTRIBUTE &quot;datatype&quot; = &quot;struct{first,last,step}&quot;
                DATASET &quot;first&quot; {
                    ATTRIBUTE &quot;datatype&quot; = &quot;real&quot;
                    DATA = 0
                }
                DATASET &quot;last&quot; {
                    ATTRIBUTE &quot;datatype&quot; = &quot;real&quot;
                    DATA = 3000
                }
                DATASET &quot;step&quot; {
                    ATTRIBUTE &quot;datatype&quot; = &quot;real&quot;
                    DATA = 1
                }
            }
            DATASET &quot;closedleft&quot; {
                ATTRIBUTE &quot;datatype&quot; = &quot;bool&quot;
                DATA = 1
            }
        }
    }
    DATASET &quot;isdensity&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;bool&quot;
        DATA = 0
    }
    DATASET &quot;weights&quot; {
        ATTRIBUTE &quot;datatype&quot; = &quot;array&lt;1&gt;{real}&quot;
        DATA = [...]
    }
}</code></pre><p>Multi-dimensional histograms will have groups <code>axis_2</code>, etc., with a multi-dimensional array as the value of dataset <code>weights</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../metadata/">Metadata »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 14 January 2024 22:43">Sunday 14 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
